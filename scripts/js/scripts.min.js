$(document).ready(function(){
	$("#prontuario").mask("9999999999");
	$("#rg").mask("999999999999999");
    $("#cartao_sus").mask("999 9999 9999 9999");
    $("#telefone").mask("(99) 9 9999-9999");
	$("#cep").mask("99.999-999");

    $('#showPassword').on('click', function(){
        var passwordField = $('#senha');
        var passwordFieldType = passwordField.attr('type');
        if(passwordFieldType == 'password')
        {
            passwordField.attr('type', 'text');
            $(this).val('Hide');
        } else {
            passwordField.attr('type', 'password');
            $(this).val('Show');
        }
    });

    let notify = setTimeout(function tempo() {
        document.getElementById('notifications').style.display="none";
    }, 5000)

    $('table.main-table').DataTable({
        "language": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "_MENU_ resultados por página",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
            },
        }
    });

    $(document).ready(function(){
        $('.doctor-schedule').DataTable({
            initComplete: function () {
                this.api().columns(3).every( function () {
                    var column = this;
                    var select = $('<select class="form-select"><option value="">Dia</option></select>')
                        .appendTo( $(column.header()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );
    
                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );
    
                    column.data().unique().sort().each( function ( d, j ) {
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );

                this.api().columns(4).every( function () {
                    var column = this;
                    var select = $('<select class="form-select"><option value="">Hora</option></select>')
                        .appendTo( $(column.header()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );
    
                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );
    
                    column.data().unique().sort().each( function ( d, j ) {
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );
                
                this.api().columns(5).every( function () {
                    var column = this;
                    var select = $('<select class="form-select"><option value="">Ano</option></select>')
                        .appendTo( $(column.header()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );
    
                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );
    
                    column.data().unique().sort().each( function ( d, j ) {
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );
            },
            "language": {
                "sEmptyTable": "Nenhum registro encontrado",
                "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
                "sInfoFiltered": "(Filtrados de _MAX_ registros)",
                "sInfoPostFix": "",
                "sInfoThousands": ".",
                "sLengthMenu": "_MENU_ resultados por página",
                "sLoadingRecords": "Carregando...",
                "sProcessing": "Processando...",
                "sZeroRecords": "Nenhum registro encontrado",
                "sSearch": "Pesquisar",
                "oPaginate": {
                    "sNext": "Próximo",
                    "sPrevious": "Anterior",
                    "sFirst": "Primeiro",
                    "sLast": "Último"
                },
            }
        });
	});

    $('#especialidade').change(function(){
        $('#medico').load('funcao.php?especialidade='+$('#especialidade').val());
    });

    $('.arquivos').click(function(){
        if($('#dfp').is(':checked') || $('#dfop').is(':checked') || $('#crp').is(':checked') || $('#emp').is(':checked') ||
           $('#dmcp').is(':checked') || $('#fccp').is(':checked') || $('#vccp').is(':checked') || $('#dpop').is(':checked')){
            $('.agendamento').css('display', 'none');
            $('.agendamento').prop('disabled', true);
            $('#prosseguirce').css('display', 'block');
            $('#prosseguir').css('display', 'none');
        } else {
            $('.agendamento').css('display', 'block');
            $('.agendamento').prop('disabled', false);
            $('#prosseguirce').css('display', 'none');
            $('#prosseguir').css('display', 'block');
        }
    });
    
    $('.ausente').click(function(){
        if($('#sim').is(':checked')){
            $('.consulta').prop('disabled', true);
            $('#fconsulta').css('display', 'none');
            $('#terminar').css('display', 'block');
        } else {
            $('.consulta').prop('disabled', false);
            $('#fconsulta').css('display', 'block');
            $('#terminar').css('display', 'none');
        }
    });
});

$("#cep").blur(function(){
    var cep = this.value.replace(/[^0-9]/, "");
    cep = cep.replace(/[^0-9]/, "");
    
    if(cep.length != 8){
        return false;
    }
    
    var url = "https://viacep.com.br/ws/"+cep+"/json/";
    
    $.getJSON(url, function(dadosRetorno){
        try{
            $("#logradouro").val(dadosRetorno.logradouro);
            $("#bairro").val(dadosRetorno.bairro);
            $("#municipio").val(dadosRetorno.localidade);
            $("#numero").focus();
        }catch(ex){}
    });
});

var consulta = function (val) {
    return val.replace(/\D/g, '').length > 6 ? '000.000.000-00' : '000000#';
},

options = {
    onKeyPress: function(val, e, field, options) {
       field.mask(consulta.apply({}, arguments), options);
    }
};
$('#consulta').mask(consulta, options);

function is_cpf (c) {
    if((c = c.replace(/[^\d]/g,"")).length != 11)
      return false

    if (c == "00000000000")
      return false;
    if (c == "11111111111")
      return false;
    if (c == "22222222222")
      return false;
    if (c == "33333333333")
      return false;
    if (c == "44444444444")
      return false;
    if (c == "55555555555")
      return false;
    if (c == "66666666666")
      return false;
    if (c == "77777777777")
      return false;
    if (c == "88888888888")
      return false;
    if (c == "99999999999")
      return false;

    var r;
    var s = 0;

    for (i=1; i<=9; i++)
      s = s + parseInt(c[i-1]) * (11 - i);

    r = (s * 10) % 11;

    if ((r == 10) || (r == 11))
      r = 0;

    if (r != parseInt(c[9]))
    return false;

    s = 0;

    for (i = 1; i <= 10; i++)
        s = s + parseInt(c[i-1]) * (12 - i);

    r = (s * 10) % 11;

    if ((r == 10) || (r == 11))
        r = 0;

    if (r != parseInt(c[10]))
        return false;

    return true;
}


function fMasc(objeto,mascara) {
    obj=objeto
    masc=mascara
    setTimeout("fMascEx()",1)
}

function fMascEx() {
    obj.value=masc(obj.value)
}

function mCPF(cpf){
    cpf=cpf.replace(/\D/g,"")
    cpf=cpf.replace(/(\d{3})(\d)/,"$1.$2")
    cpf=cpf.replace(/(\d{3})(\d)/,"$1.$2")
    cpf=cpf.replace(/(\d{3})(\d{1,2})$/,"$1-$2")
    return cpf
}

cpfCheck = function (el) {
	document.getElementById('validador').innerHTML = is_cpf(el.value)? '<span style="color:green">válido</span>' : '<span style="color:red">inválido</span>';
    if(el.value=='') document.getElementById('validador').innerHTML = '';
}

$("#nome").on("input", function(){
    var regexp = /[^a-zA-Zà-úÀ-Ú '-]/g;
    if(this.value.match(regexp)){
        $(this).val(this.value.replace(regexp,''));
    }
});

$("#usuario").on("input", function(){
    var regexp = /[^a-z0-9'.-]/g;
    if(this.value.match(regexp)){
        $(this).val(this.value.replace(regexp,''));
    }
});

var file = document.getElementById('arq_doc_foto');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

var file = document.getElementById('arq_cartao_sus');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

var file = document.getElementById('arq_enc_medico');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

var file = document.getElementById('arq_doc_med_comp');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

var file = document.getElementById('arq_cartao_consulta_frente');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

var file = document.getElementById('arq_cartao_consulta_verso');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

var file = document.getElementById('arq_doc_pos_operatorio');
file.onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch (ext) {
        case 'pdf':
            break;
        case 'PDF':
            break;
        default:
            alert('Formato Inválido! Envie um arquivo no formato PDF');
            this.value = '';
    }
};

function habProc(){
    if(document.getElementById('autorizar').checked){
        document.getElementById('prosseguir').removeAttribute("disabled");
    }
    else{
        document.getElementById('prosseguir').setAttribute("disabled", "disabled");    
    }
}